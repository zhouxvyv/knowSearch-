<!doctype html>
<html lang="zh-CN">
<head>
    <!-- 必须的 meta 标签 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ZHIFOU Background</title>
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/homePage.css">
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/background.css">
    <link rel="stylesheet" href="../font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/backgroundQues.css">
    <script src="../Js/jquery-3.5.1.js"></script>
    <script src="../Js/bootstrap.bundle.min.js"></script>
    <script src="../Js/echarts.min.js"></script>
    <script src="../Js/echarts-wordcloud.js"></script>
    <script src="../../kityformula-master/example/editor/ckeditor.js"></script>
    <style>
        .topic-text{
            margin-bottom: 10px;
        }
        .topic-text div{
            width: 90%;
            margin-left: 4%;
            font-size: 16px;
            margin-top: 4px;
            color: #6C757D;
            padding: 10px;
            border: 1px solid #d5d5da;
            border-radius: 10px;
        }
        .topic-text strong{
            margin-left: 4%;
            line-height: 30px;
            font-size: 16px;
        }
        .topic-text button{
            height: 30px;
            float: right;
            margin-right: 7%;
            border: 0;
            padding: 5px 10px;
            color: whitesmoke;
            border-radius: 5px;

        }
        #warn{
            font-size: 18px;
            line-height: 30px;
            color: #4fa0ff;
            font-weight: bold;
        }
    </style>
</head>
<body>
<header style="margin-bottom: 0px">
    <nav class="navbar navbar-expand-lg navbar-light" style="background-color: #03152a;max-height: 50px;padding: 4px 0">
        <div class="container-fluid">
            <a href="../../index3/html/home.html"
               class="d-flex align-items-center col-lg-1  mb-lg-0 link-dark text-decoration-none">
                <img src="../image/ZHIFOUBlackSeries.png" alt="zhifou" height="45px" style="margin-left: 10px">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar"
                    aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">


                </ul>
                <div class="flex-shrink-0 dropdown d-flex dropstart" style="margin-left: 0%;margin: 0px 30px">
                    <a href="#" class="d-block link-dark text-decoration-none mx-auto" id="dropdownUser2"
                       data-bs-toggle="dropdown"
                       aria-expanded="false">
                        <img src="../image/userLogo.png" alt="mdo" width="32" height="32" class="rounded-circle ">
                    </a>
                    <ul class="dropdown-menu dropstart text-small shadow" aria-labelledby="dropdownUser2">
                        <li><a class="dropdown-item" href="#">New project...</a></li>
                        <li><a class="dropdown-item" href="#">Settings</a></li>
                        <li><a class="dropdown-item" href="#">Profile</a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="#">Sign out</a></li>
                    </ul>
                </div>
                <!--<form class="d-flex" role="search">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>-->
            </div>
        </div>
    </nav>
</header>

<div class="container-fluid user-main" style="padding-left: 0px">
    <div class="wrapper">
        <div class="leftside-menu leftside-menu-detached show bg-white" style="width: 190px;height: 90%">
            <div class="leftbar-user" style="height: 50px">


            </div>
            <li class="side-nav-item menuitem-active side-top pt-2 pb-2"
                style="float: left;width: 100%;margin-left: 20px">
                <i class="fa fa-bar-chart" aria-hidden="true" style="color: #428bca;margin-right: 10px"></i>
                <a href="BackgroundData.html">
                    <i class="uil-home-alt"></i>
                    <span style="color: #428bca"> <strong>数据面板 </strong>
                        <i class="fa fa-angle-right" style="font-weight: 1000" aria-hidden="true"></i></span>
                </a>
            </li>
            <li class="side-nav-item menuitem-active side-top" style="margin-top: 10px;float: left;margin-left: 20px">
                <i class="fa fa-newspaper-o" aria-hidden="true" style="color: #6C757D;margin-right: 10px"></i>
                <a data-bs-toggle="collapse" href="https://coderthemes.com/hyper/modern/index.html#sidebarDashboards"
                   aria-expanded="false" aria-controls="sidebarDashboards" class="side-nav-link collapsed">
                    <i class="uil-home-alt"></i>
                    <span style="color: #6C757D"> 题单数据</span>
                </a>
                <div class="collapse" id="sidebarDashboards" style="">
                    <ul class="side-nav-second-level">
                        <li class="side-item">
                            <a href="DailyPracticeToday.html" style="color: #6C757D">新增客观题</a>
                        </li>
                        <li class="side-item">
                            <a href="#" class="active" style="color: #6C757D">题目管理</a>
                        </li>
                        <li class="side-item">
                            <a href="#" style="color: #6C757D">政治</a>
                        </li>
                        <li class="side-item">
                            <a href="#" style="color: #6C757D">计算机组成原理</a>
                        </li>
                    </ul>
                </div>
            </li>


        </div>
        <div class="content-page" style="padding-left: 0">
            <div class="content">
                <div class="quesMain" style="padding-top: 65px">
                    <div class="card widget-flat" style="margin-bottom: 0">
                        <div class="row" style="padding-top: 20px;padding-bottom: 20px">

                            <div class="col-sm-5">
                                <div class="row" style="padding-left: 40px">
                                    <div class="number_cur col-sm-1"
                                         style="float: left;font-size: 16px;padding-top: 3px;padding-left: 10px">1
                                    </div>
                                    <div class="col-sm-5" style="padding-top: 5px">
                                        <span style="margin-left: 10px;font-size: 16px">输入题目内容</span>
                                    </div>
                                    <div class="space col-sm-5" style="margin-top: 15px"></div>
                                </div>
                            </div>
                            <div class="col-sm-5">
                                <div class="row" style="padding-left: 40px">
                                    <div class="number col-sm-1"
                                         style="float: left;font-size: 16px;padding-top: 3px;padding-left: 10px">2
                                    </div>
                                    <div class="col-sm-5" style="padding-top: 5px">
                                        <span style="margin-left: 10px;font-size: 16px">检查输入内容</span>
                                    </div>
                                    <div class="space col-sm-5" style="margin-top: 15px"></div>
                                </div>
                            </div>
                            <div class="col-sm-2" style="padding-left: 0">
                                <div style="padding-left: 0px">
                                    <div class="number"
                                         style="float: left;font-size: 16px;padding-top: 3px;padding-left: 2px">3
                                    </div>
                                    <div style="padding-top: 5px">
                                        <span style="margin-left: 10px;font-size: 16px">完成</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row "></div>
                <div class="card widget-flat" style="margin-bottom: 0">
                    <div class="row" style="padding-top: 20px;padding-bottom: 20px">

                        <div class="col-sm-8 bg-white" style="margin-left: 17%">
                            <div style="margin-left: 4%">
                                <div style="padding: 15px">
                                    <span style="color: #6C757D"><strong>难度</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="inlineRadioOptions1"
                                               id="inlineRadio1" value="1">
                                        <label class="form-check-label" for="inlineRadio1"
                                               style="color: #0b894a"><strong>简单</strong></label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="inlineRadioOptions1"
                                               id="inlineRadio2" value="2" checked>
                                        <label class="form-check-label" for="inlineRadio2"
                                               style="color: #f5d814 "><strong>中等</strong></label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="inlineRadioOptions1"
                                               id="inlineRadio3" value="3">
                                        <label class="form-check-label" for="inlineRadio3"
                                               style="color:#e74f5b"><strong>困难</strong></label>
                                    </div>
                                </div>
                                <div style="padding: 15px">
                                    <span style="color: #6C757D"><strong>类型</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="inlineRadioOptions3"
                                               id="inlineRadio7" value="1">
                                        <label class="form-check-label" for="inlineRadio8"
                                               style="color: #6C757D "><strong>填空题</strong></label>
                                    </div>
                                    <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="inlineRadioOptions3"
                                               id="inlineRadio8" value="2" checked>
                                        <label class="form-check-label" for="inlineRadio7"
                                               style="color: #6C757D"><strong>选择题</strong></label>
                                    </div>
                                </div>
                                <div id="choiceAmount" style="padding: 0px 15px 10px 15px;display: block" class="row">
                                    <label for="amountRange" class="form-label"
                                           style="color: #6C757D;width: 20%"><strong>选项数量</strong>
                                        <span id="amountResult" class="badge rounded bg-primary font-10" style="margin-left: 14px">4</span>
                                    </label>

                                    <input type="range"style="width: 50%;padding-top: 15px" class="form-range" min="2" max="6" step="1" id="amountRange">
                                </div>
                            </div>

                            <div style="margin-left: 4%;width: 92%" id="quesMain">
                                <!--<div class='topic-text'>
                                    <strong style='color: #4e8ecf'>题目描述预览&nbsp;</strong>
                                    <button onclick='remove()'>移除</button>
                                    <button onclick='update()'>修改</button>
                                    <div></div>
                                </div>-->
                            </div>

                            <div style="width: 90%;margin-left: 4%">
                                <div id="warn">请输入题目:</div>
                                <div class="col-sm-12">
                                    <div id="body" name="body" style="display: none;margin-top: 20px">

                                    </div>
                                </div>
                            </div>

                            <script>
                                CKEDITOR.replace('body', {
                                    filebrowserImageUploadUrl: "/",
                                    height: 120
                                });
                            </script>
                            <button id="btnAppend" onclick="addText()" style="margin-top: 10px;margin-right: 6%;width: 100px;height:40px;background-color: #4e8ccd;color: #FFFFFF;border: 0px;float: right;border-radius: 0.3rem;font-weight: bolder;">
                                保存
                            </button>
                            <button id="btnDelete" onclick="deleteQue()" style="margin-top: 10px;margin-right: 1%;width: 60px;height:40px;background-color: #02ba00;color: #FFFFFF;border: 0px;float: right;border-radius: 0.3rem;font-weight: bolder;">
                                提交
                            </button>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>

    class NoTopic {
        texts = []
        subjectName = ""
        type = "单选题"
        htmls = []

        constructor() {
        }

        addTextAndHtml(html){
            var text = this.readDocument(html)
            if(text==undefined || text==""){
                return text
            }
            this.htmls.push(html)
            this.texts.push(text)
            return text
        }

        insertTextAndHtml(html,n){
            var text = this.readDocument(html)
            if(text==undefined || text==""){
                return text
            }
            var tempText = []
            var tempHtml = []
            var len = this.htmls.length
            for (let i = 0; i < len; i++) {
                if (i==n){
                    tempText.push(text)
                    tempHtml.push(html)
                }
                tempText.push(this.texts[i])
                tempHtml.push(this.htmls[i])
            }
            this.texts = tempText
            this.htmls = tempHtml
            return text
        }

        setTextAndHtml(html,n){
            var text = this.readDocument(html)
            if(text==undefined || text==""){
                this.removeTextAndHtmlN(n)
                return
            }
            this.htmls[n] = html
            this.texts[n] = text
            return text
        }

        removeTextAndHtml(){
            this.texts.pop()
            return this.htmls.pop()
        }

        removeTextAndHtmlN(n){
            var tempText = []
            var tempHtml = []
            var html
            for (let i = 0; i < this.htmls.length; i++) {
                if (i!=n){
                    tempText.push(this.texts[i])
                    tempHtml.push(this.htmls[i])
                }else {
                    html = this.htmls[i]
                }
            }
            this.texts = tempText
            this.htmls = tempHtml
            return html
        }

        readDocument(html){
            html = html.replace(/<img( class=\"([^\"]*)\")?( style=\"([^\"]*)\")?( data-cke-saved-src=\"([^\"]*)\")?( src=\"([^\"]*)\")? data-latex=\"([^\"]*)\">/g,"`$9`")
            html = html.replace(/<.r>/,"")

            html = html.replace("<sub></sub>","")
            html = html.replace(/<span[^>]*>/g,"")
            html = html.replace(/<\/span[^>]*>/g,"")
            html = html.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}_{$4}^{$6}`")
            html = html.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$6}^{$4}`")
            html = html.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}^{$4}`")
            html = html.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$4}`")
            return html;
        }
    }

    var promptLevel = 0  // 0-除了非法内容,切换动作时默认提交动作结果  1-动作未完成,切换时提醒

    var warn = ["请输入题目内容", "请输入选项内容"]
    var contentTitle = ["题目标题","选项A","选项B","选项C","选项D","选项E","选项F","选项G","选项H","选项I"]
    var nowStep = 0
    var isUpdate = -1  // -1代表在插入  >=0代表在更新某一个
    var noTopic = new NoTopic()
    var showSectionID = "#quesMain"
    var showWarningSectionId = "#warn"

    // 添加选项
    function addText(){ // 添加新列
        var bodyHtml = $("#cke_body").find("iframe").contents().find("body")[0].innerHTML;
        var text
        // 如果处于修改状态,结束修改
        if(isUpdate>=0){
            text = noTopic.setTextAndHtml(bodyHtml,isUpdate)
            isUpdate = -1
            $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = ""
        }else{
            text = noTopic.addTextAndHtml(bodyHtml)
            if(text===undefined ||text==="") {
                console.log("添加失败")
            }else {
                nowStep++
                $("#cke_body").find("iframe").contents().find("body")[0].innerHTML=""
            }
        }

        showTopic()
        return text
    }
    // 修改内容
    function update(e){
        addText()
        var no = parseInt($(e).parent().attr("no"), 10)
        isUpdate = no
        $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = noTopic.htmls[no]
        showTopic()
    }
    // 移除内容,如果还在修改,先完成修改再移除
    function remove(e){
        if(isUpdate>=0 && promptLevel<1){
            addText()
        }else if(isUpdate>=0) {
            alert("当前还在修改中")
            return
        }
        var no = parseInt($(e).parent().attr("no"), 10)
        noTopic.removeTextAndHtmlN(no)
        nowStep--
        showTopic()
    }
    // 将输入的内容插入到按钮位置,修改状态将修改项移动到该位置
    function insert(e){
        var bodyHtml = $("#cke_body").find("iframe").contents().find("body")[0].innerHTML
        var no = parseInt($(e).parent().attr("no"), 10)
        if(isUpdate>0 && promptLevel<1){
            noTopic.insertTextAndHtml(bodyHtml, no)
            if(no<isUpdate) isUpdate++
            $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = ""
            noTopic.removeTextAndHtmlN(isUpdate)
            isUpdate = -1
        }else if(isUpdate>0) {
            alert("当前还在修改中")
            return
        }else if(isUpdate==-1){
            noTopic.insertTextAndHtml(bodyHtml,no)
            nowStep++
            $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = ""
        }
        showTopic()
    }

    function showTopic(){
        var showSection = $(showSectionID)
        var html = ""
        for(var i=0;i<noTopic.htmls.length;i++){
            // 题目标题不允许移除
            if(i===0){
                html = html + "" +
                    "                                <div class='topic-text' no='"+ i +"'>\n" +
                    "                                    <strong style='color: #4e8ecf'>"+ contentTitle[i] +"&nbsp;</strong>\n" +
                    "                                    <button style='background-color: orange' onclick='update(this)'>修改</button>\n" +
                    "                                    <div>"+ noTopic.htmls[i] +"</div>\n" +
                    "                                </div>";
            }
            else {
                html = html + "" +
                    "                                <div class='topic-text' no='"+ i +"'>\n" +
                    "                                    <strong style='color: #4e8ecf'>"+ contentTitle[i] +"&nbsp;</strong>\n" +
                    "                                    <button style='background-color: #cc544e' onclick='remove(this)'>移除</button>\n" +
                    "                                    <button style='background-color: orange' onclick='update(this)'>修改</button>\n" +
                    "                                    <button style='background-color: #4e8ccd' onclick='insert(this)'>插入</button>\n" +
                    "                                    <div>"+ noTopic.htmls[i] +"</div>\n" +
                    "                                </div>";
            }
        }
        showSection.html(html)
        showWarning()
    }
    function showWarning(){
        var warnSection = $(showWarningSectionId)
        if(isUpdate==-1){
            warnSection.html("请输入"+ contentTitle[nowStep] +"...")
        }else{
            if(isUpdate==0){
                warnSection.html("请修改标题内容...")
            }else{
                warnSection.html("请修改"+ contentTitle[isUpdate] +"内容或插入新的位置...")
            }
        }
    }

    // 可以读取富文本框的内容为数据库中格式, 需要获取html()
    /*function readDocument(dmt){
        dmt = dmt.replace(/<img( class=\"([^\"]*)\")?( style=\"([^\"]*)\")?( data-cke-saved-src=\"([^\"]*)\")?( src=\"([^\"]*)\")? data-latex=\"([^\"]*)\">/g,"`$9`")
        dmt = dmt.replace(/<.r>/,"")

        dmt = dmt.replace("<sub></sub>","")
        dmt = dmt.replace(/<span[^>]*>/g,"")
        dmt = dmt.replace(/<\/span[^>]*>/g,"")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}_{$4}^{$6}`")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$6}^{$4}`")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}^{$4}`")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$4}`")
        return dmt;
    }*/
</script>

</body>
</html>