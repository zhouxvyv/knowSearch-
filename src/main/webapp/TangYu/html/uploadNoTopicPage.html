<!doctype html>
<html lang="zh-CN">
<head>
    <!-- 必须的 meta 标签 -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/homePage1.css">
    <link rel="stylesheet" href="../css/section/video.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <script src="../../MathJax-2.7.7/MathJax.js?config=AM_HTMLorMML-full" async></script>
    <style>

        @font-face{
            font-family: "yuan_ti1";
            src: url('../../zx-FONT/975MaruSC-Regular.ttf');
        }@font-face{
            font-family: "yuan_ti2";
            src: url('../../zx-FONT/975MaruSC-Medium.ttf');
        }@font-face{
            font-family: "yuan_ti3";
            src: url('../../zx-FONT/975MaruSC-Bold.ttf');
        }@font-face{
            font-family: "kai_ti1";
            src: url('../../zx-FONT/yrdkai-Medium.ttf');
        }


        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }
        #right{
            width: 23%;
            position: absolute;
            right: 0;
            z-index: 100;
            transition-duration: 0.4s;
        }
        #right:hover{
            width: 70%;
        }
        .section{
            box-sizing: border-box;
            background-color: #fcfcfc;
            border-radius: 7px;
            padding: 7px;
            margin-bottom: 6px;
            min-height: 100px;
        }




        #myNoTopicList{
            width: 100%;
            overflow: hidden;
        }
        #myNoTopicList .noTopic{
            width: 100%;
            padding: 5px 0;
            border-bottom: 1px solid;
            border-top: 1px solid;
            position: relative;
        }
        #myNoTopicList .noTopic div:first-of-type{
            width: 100px;
            height: 100%;
            position: absolute;
            background-image: linear-gradient(to right,#fcfcfc00,#fcfcfc55,#fcfcfcaa,#fcfcfcff,#fcfcfcff);
            z-index: 99;
            right: 0;
        }
        #myNoTopicList .noTopic div:last-of-type{
            width: 1000px;
        }



        .topic-text{
            margin-bottom: 10px;
        }
        .topic-text div{
            width: 90%;
            margin-left: 4%;
            font-size: 16px;
            margin-top: 4px;
            color: #6C757D;
            padding: 10px;
            border: 1px solid #d5d5da;
            border-radius: 10px;
        }
        .topic-text strong{
            margin-left: 4%;
            line-height: 30px;
            font-size: 16px;
        }
        .topic-text button{
            height: 30px;
            float: right;
            margin-right: 7%;
            border: 0;
            padding: 5px 10px;
            color: whitesmoke;
            border-radius: 5px;

        }
        #warn{
            font-size: 18px;
            line-height: 30px;
            color: #4fa0ff;
            font-weight: bold;
        }
        #nowTopicHead div{
            width: 25%;
            float: left;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border: 0;
            margin: 0;
            color: #4fa0ff;
            font-weight: bold;
            font-size: 16px;
        }
        #answers .section.answer div{
            padding-left: 100px;
            position: relative;
        }
        #answers .section.answer div.confirmAnswer{
            padding: 0 10px;
            opacity: 0;
            background-color: #02ba00;
            color: white;
            font-weight: bold;
            position: absolute;
            right: 100px;
            top: 3px;
            cursor: pointer;
            height: 30px;
            line-height: 30px;
            z-index: 999;
            transition-duration: 0.3s;
        }
        #answers .section.answer:hover div.confirmAnswer{
            opacity: 1;
        }
        #answers .section.answer div.removeAnswer{
            padding: 0 10px;
            opacity: 0;
            background-color: red;
            color: white;
            font-weight: bold;
            position: absolute;
            right: 10px;
            top: 3px;
            cursor: pointer;
            height: 30px;
            line-height: 30px;
            z-index: 999;
            transition-duration: 0.3s;
        }
        #answers .section.answer:hover div.removeAnswer{
            opacity: 1;
        }
        #answers .section.answer div span{
            display: block;
            position: absolute;
            left: 10px;
            top: 3px;
        }
        #answers .section.answer{
            position: relative;
        }
    </style>
    <link rel="stylesheet" href="../css/userTarget.css">
    <script src="../Js/bootstrap.bundle.min.js"></script>
    <script src="../Js/jquery-3.5.1.min.js"></script>
    <script src="../Js/uploadNoTopicPage.js"></script>
    <script src="../Js/echarts.min.js"></script>
    <script src="../Js/echarts-wordcloud.js"></script>
    <script src="../../kityformula-master/example/editor/ckeditor.js"></script>
</head>
<body style="overflow-x: hidden;background-color: #f1f1f1">

<header>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a href="#" class="d-flex align-items-center col-lg-1  mb-lg-0 link-dark text-decoration-none">
                <img src="../image/ZhiFouLogo.png" alt="zhifou" height="44px" style="margin-left: 10px">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbar">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item" style="margin: 0px 20px">
                        <a href="/TangYu/html/homePage.html" class="nav-link px-2 "><strong>首页</strong></a>
                    </li>
                    <li class="nav-item" style="margin: 0px 20px">
                        <a href="/TangYu/html/DailyPracticeToday.html" class="nav-link px-2"><strong>每日一练</strong></a>
                    </li>
                    <!--<li class="nav-item" style="margin: 0px 20px">
                        <a href="#" class="nav-link px-2 "><strong>在线考试</strong></a>
                    </li>-->
                    <li class="nav-item" style="margin: 0px 20px">
                        <a href="/TangYu/html/uploadAnswerPage.html" class="nav-link px-2 "><strong>我来作答</strong></a>
                    </li>
                    <li class="nav-item" style="margin: 0px 20px">
                        <a href="javascript: alert('请自行解决')" class="nav-link px-2 "><strong>帮助与反馈</strong></a>
                    </li>

                </ul>
                <div id="noUserTarget" >
                    <a onclick="clickToLogin()" style="cursor: pointer;text-decoration: none;color: #0d6efd;font-weight: bolder;">登录</a>
                    <span style="font-weight: bolder">
                        &nbsp;&nbsp;/&nbsp;&nbsp;
                    </span>
                    <a onclick="clickToSignUp()" style="cursor: pointer;text-decoration: none;color: #0d6efd;font-weight: bolder">注册</a>
                    <!-- <a href="#" class="d-block link-dark text-decoration-none mx-auto" id="dropdownUser2"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                         <img src="../image/userLogo.png" alt="mdo" width="32" height="32" class="rounded-circle ">
                     </a>
                     <ul class="dropdown-menu dropstart text-small shadow" aria-labelledby="dropdownUser2">
                         <li><a class="dropdown-item" href="#">New project...</a></li>
                         <li><a class="dropdown-item" href="#">Settings</a></li>
                         <li><a class="dropdown-item" href="#">Profile</a></li>
                         <li>
                             <hr class="dropdown-divider">
                         </li>
                         <li><a class="dropdown-item" href="#">Sign out</a></li>
                     </ul>-->
                </div>
                <div style="display: none" id="userTarget">
                    <script>
                        defaultUrl = "../image/avatar_1617068871.png"
                    </script>
                    <div id="asset" style="position: absolute;left: 8px;top: 8px">
                        <img src="../image/asset.gif" style="width: 15px;height: 15px" alt="">
                        <span style="font-weight: bold;color: gold;line-height: 15px">123</span>
                    </div>
                    <img id="userAvatar" src="../image/avatar_1617068871.png" onError="this.src=defaultUrl;this.onerror=null">
                    <div id="userName">
                        <span></span>
                        <div id="navigate">
                            <ul>
                                <li><a href="/project/html/home.html">我的主页</a></li>
                                <li><a href="/project/html/mistake.html">错题本</a></li>
                                <li><a href="/project/html/record.html">搜索记录</a></li>
                                <li><a href="/project/html/collection.html">我的收藏</a></li>
                                <li><a href="/project/html/lesson.html">我的课程</a></li>
                                <li><a id="exit" onclick="exit()" href="">退出</a></li>
                                <script>
                                    function exit(){
                                        $.ajax({
                                            url: "/exitServlet.Servlet",
                                            type: "post",
                                            dataType: "json",
                                            data: {},
                                            success: function (res){
                                                if(res.success){
                                                    window.open("/TangYu/html/homePage.html","_self")
                                                }
                                            }
                                        })
                                    }
                                </script>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</header>

<div class="" style="width: 95%;margin: 10px auto 0;position: relative">
    <div style="position: absolute;width: 100%">
        <!--右边范围-->
        <div id="right" style="">

            <div class="section" onclick="showAddTopic()" style="min-height:0;font-size: 16px;text-align: center;line-height: 30px;cursor: pointer">新建题目</div>
            <div class="section">
                <div id="myNoTopicList">
                    <div class="noTopic">
                        <div></div>
                        <div>
                            设常数`\lambda \gt 0`, 且 `\sum_{n=1}^{\infty} a_n^2` 收敛,  则`\sum_{n=1}^{\infty} (-1)^ {n}\frac {|a_ {n}|}{\sqrt {n^2+\lambda}}`()。
                        </div>
                    </div>
                    <div class="noTopic">
                        <div></div>
                        <div>
                            设常数`\lambda \gt 0`, 且 `\sum_{n=1}^{\infty} a_n^2` 收敛,  则`\sum_{n=1}^{\infty} (-1)^ {n}\frac {|a_ {n}|}{\sqrt {n^2+\lambda}}`()。
                        </div>
                    </div>
                    <div class="noTopic">
                        <div></div>
                        <div>
                            设常数`\lambda \gt 0`, 且 `\sum_{n=1}^{\infty} a_n^2` 收敛,  则`\sum_{n=1}^{\infty} (-1)^ {n}\frac {|a_ {n}|}{\sqrt {n^2+\lambda}}`()。
                        </div>
                    </div>
                    <div class="noTopic">
                        <div></div>
                        <div>
                            设常数`\lambda \gt 0`, 且 `\sum_{n=1}^{\infty} a_n^2` 收敛,  则`\sum_{n=1}^{\infty} (-1)^ {n}\frac {|a_ {n}|}{\sqrt {n^2+\lambda}}`()。
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--左边范围-->
        <div style="width: 76%;float: left;box-sizing: border-box;padding: 0">
            <div class="section">
                <div class="content-page" style="padding-left: 0">
                    <div class="content">
                        <div id="addTopic" class="card widget-flat" style="margin-bottom: 0">
                            <div class="row" style="padding-top: 20px;padding-bottom: 20px">

                                <div style="">
                                    <div style="">
                                        <div style="padding: 0 40px 10px">
                                            <span style="color: #6C757D"><strong>类型</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions1"
                                                       id="inlineRadio8" value="选择题" checked>
                                                <label class="form-check-label" for="inlineRadio7"
                                                       style="color: #6C757D"><strong>选择题</strong></label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions1"
                                                       id="inlineRadio7" value="填空题">
                                                <label class="form-check-label" for="inlineRadio8"
                                                       style="color: #6C757D "><strong>填空题</strong></label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions1"
                                                       id="inlineRadio9" value="简答题">
                                                <label class="form-check-label" for="inlineRadio7"
                                                       style="color: #6C757D"><strong>简答题</strong></label>
                                            </div>
                                        </div>
                                        <div style="padding: 0 40px 10px">
                                            <span style="color: #6C757D"><strong>学科</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="inlineRadioOptions3"
                                                       id="inlineRadio1" value="高等数学" checked>
                                                <label class="form-check-label" for="inlineRadio8"
                                                       style="color: #6C757D "><strong>高等数学</strong></label>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="margin-left: 4%;width: 92%" id="quesMain">
                                        <!--<div class='topic-text'>
                                            <strong style='color: #4e8ecf'>题目描述预览&nbsp;</strong>
                                            <button onclick='remove()'>移除</button>
                                            <button onclick='update()'>修改</button>
                                            <div></div>
                                        </div>-->
                                    </div>

                                    <div style="width: 90%;margin-left: 4%">
                                        <div id="warn">请输入题目:</div>
                                        <div class="col-sm-12">
                                            <div id="body" name="body" style="display: none;margin-top: 20px">

                                            </div>
                                        </div>
                                    </div>

                                    <script>
                                        CKEDITOR.replace('body', {
                                            filebrowserImageUploadUrl: "/",
                                            height: 120
                                        });
                                    </script>
                                    <button id="btnAppend" onclick="addText()" style="margin-top: 10px;margin-right: 6%;width: 100px;height:40px;background-color: #4e8ccd;color: #FFFFFF;border: 0px;float: right;border-radius: 0.3rem;font-weight: bolder;">
                                        保存
                                    </button>
                                    <button id="btnDelete" onclick="commitTopic()" style="margin-top: 10px;margin-right: 1%;width: 60px;height:40px;background-color: #02ba00;color: #FFFFFF;border: 0px;float: right;border-radius: 0.3rem;font-weight: bolder;">
                                        提交
                                    </button>
                                </div>

                            </div>
                        </div>
                        <div id="nowTopic" style="display: none;padding: 0 30px">
                            <div id="nowTopicHead"><div id="showType">类型：选择题</div><div id="showTime">上传时间：2022-4-26</div><div id="showCount">答案数量：12</div><div><div id="delete" style="width: 80px;height: 34px;line-height: 34px;border-radius: 8px;background-color: #ec0000;color: white;margin: 3px 3px;cursor: pointer" onclick="deleteNowTopic()">删除</div></div></div>
                            <div id="topicTitle" style="margin-bottom: 20px;">
                                设`f_1 (x)=frac {1}{1+x}`,`f_2( x ) = sqrt{3x^2-4x^3}`,`f_3(x)=sin2x-2sinx`,`f_4(x)=1+tan x-sqrt {1-sin x}`，则当`x`→0时，`f_1(x)`，`f_2(x)`，`f_3(x)`，`f_4(x)`按无穷小的阶数，从小到大排列为()。
                            </div>
                            <div id="topicOptions">
                                <p class="options">A、`f(x)+f(x)`必为某一随机变量的概率密度</p>
                                <p class="options">B、`f_ {1}(x)f_ {2}(x)`必为某一随机变量的概率密度</p>
                                <p class="options">C、`F_ {1}(x)+F_ {2}(x)`必为某一随机变量的分布函数</p>
                                <p class="options">D、`F_ {1}(x)F_ {2}(x)`必为某一随机变量的分布函数</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="answers" style="display: none;margin-bottom: 100px">
                <div class="section">
                    <div><span>答案：</span></div>
                    <div><span>解答过程：</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    pageInitialization()
    setTimeout(function (){
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
    },500)
</script>

<script>

    class NoTopic {
        texts = []
        subjectName = ""
        type = "单选题"
        htmls = []

        constructor() {
        }

        addTextAndHtml(html){
            var text = this.readDocument(html)
            if(text==undefined || text==""){
                return text
            }
            this.htmls.push(html)
            this.texts.push(text)
            return text
        }

        insertTextAndHtml(html,n){
            var text = this.readDocument(html)
            if(text==undefined || text==""){
                return text
            }
            var tempText = []
            var tempHtml = []
            var len = this.htmls.length
            for (let i = 0; i < len; i++) {
                if (i==n){
                    tempText.push(text)
                    tempHtml.push(html)
                }
                tempText.push(this.texts[i])
                tempHtml.push(this.htmls[i])
            }
            this.texts = tempText
            this.htmls = tempHtml
            return text
        }

        setTextAndHtml(html,n){
            var text = this.readDocument(html)
            if(text==undefined || text==""){
                this.removeTextAndHtmlN(n)
                return
            }
            this.htmls[n] = html
            this.texts[n] = text
            return text
        }

        removeTextAndHtml(){
            this.texts.pop()
            return this.htmls.pop()
        }

        removeTextAndHtmlN(n){
            var tempText = []
            var tempHtml = []
            var html
            for (let i = 0; i < this.htmls.length; i++) {
                if (i!=n){
                    tempText.push(this.texts[i])
                    tempHtml.push(this.htmls[i])
                }else {
                    html = this.htmls[i]
                }
            }
            this.texts = tempText
            this.htmls = tempHtml
            return html
        }

        readDocument(html){
            html = html.replace(/<img( class=\"([^\"]*)\")?( style=\"([^\"]*)\")?( data-cke-saved-src=\"([^\"]*)\")?( src=\"([^\"]*)\")? data-latex=\"([^\"]*)\">/g,"`$9`")
            html = html.replace(/<.r>/,"")

            html = html.replace("<sub></sub>","")
            html = html.replace(/<span[^>]*>/g,"")
            html = html.replace(/<\/span[^>]*>/g,"")
            html = html.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}_{$4}^{$6}`")
            html = html.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$6}^{$4}`")
            html = html.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}^{$4}`")
            html = html.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$4}`")
            return html;
        }
    }

    var promptLevel = 0  // 0-除了非法内容,切换动作时默认提交动作结果  1-动作未完成,切换时提醒

    var warn = ["请输入题目内容", "请输入选项内容"]
    var contentTitle = ["题目标题","选项A","选项B","选项C","选项D","选项E","选项F","选项G","选项H","选项I"]
    var nowStep = 0
    var isUpdate = -1  // -1代表在插入  >=0代表在更新某一个
    var noTopic = new NoTopic()
    var showSectionID = "#quesMain"
    var showWarningSectionId = "#warn"

    // 添加选项
    function addText(){ // 添加新列
        var bodyHtml = $("#cke_body").find("iframe").contents().find("body")[0].innerHTML;
        var text
        // 如果处于修改状态,结束修改
        if(isUpdate>=0){
            text = noTopic.setTextAndHtml(bodyHtml,isUpdate)
            isUpdate = -1
            $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = ""
        }else{
            text = noTopic.addTextAndHtml(bodyHtml)
            if(text===undefined ||text==="") {
                console.log("添加失败")
            }else {
                nowStep++
                $("#cke_body").find("iframe").contents().find("body")[0].innerHTML=""
            }
        }

        showTopic()
        return text
    }
    // 修改内容
    function update(e){
        addText()
        var no = parseInt($(e).parent().attr("no"), 10)
        isUpdate = no
        $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = noTopic.htmls[no]
        showTopic()
    }
    // 移除内容,如果还在修改,先完成修改再移除
    function remove(e){
        if(isUpdate>=0 && promptLevel<1){
            addText()
        }else if(isUpdate>=0) {
            alert("当前还在修改中")
            return
        }
        var no = parseInt($(e).parent().attr("no"), 10)
        noTopic.removeTextAndHtmlN(no)
        nowStep--
        showTopic()
    }
    // 将输入的内容插入到按钮位置,修改状态将修改项移动到该位置
    function insert(e){
        var bodyHtml = $("#cke_body").find("iframe").contents().find("body")[0].innerHTML
        var no = parseInt($(e).parent().attr("no"), 10)
        if(isUpdate>0 && promptLevel<1){
            noTopic.insertTextAndHtml(bodyHtml, no)
            if(no<isUpdate) isUpdate++
            $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = ""
            noTopic.removeTextAndHtmlN(isUpdate)
            isUpdate = -1
        }else if(isUpdate>0) {
            alert("当前还在修改中")
            return
        }else if(isUpdate==-1){
            noTopic.insertTextAndHtml(bodyHtml,no)
            nowStep++
            $("#cke_body").find("iframe").contents().find("body")[0].innerHTML = ""
        }
        showTopic()
    }
    // 将现在的题目上传或保存
    function commitTopic(){
        if(isUpdate>=0 && promptLevel<1){
            addText()
        }else if(isUpdate>=0) {
            alert("当前还在修改中")
            return
        }
        noTopic.htmls=["",""]

        for(var k=7;k<10;k++){
            console.log($("#inlineRadio"+k).get(0).checked)
            if($("#inlineRadio"+k).get(0).checked){
                noTopic.type = $("#inlineRadio"+k).val()
            }
        }
        if(noTopic.texts.length===0){
            alert("请先填入内容")
            return;
        }
        $.ajax({
            url: "/uploadNoAnswerTopicServlet",
            type: "get",
            dataType: "json",
            data: noTopic,
            success: function (res){
                if(res.success){
                    noTopic = new NoTopic()
                    showTopic()
                    nowStep=0
                    noTopicInitialization()
                    setTimeout(function (){
                        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
                    },1000)
                }
            }
        })
    }
    // 显示选择的题目
    function showNowNoTopic(e,ele){
        $(ele).find("span").css("display","none")
        showNowTopic()
        nowShow = e
        var noTopicTemp = noTopicList[nowShow]
        $("#showType").html("类型："+noTopicTemp.type)
        var topicId = noTopicTemp.topicId
        $("#topicTitle").text("【"+noTopicTemp.type+"】"+noTopicTemp.topicTitle)
        var options = JSON.parse(noTopicTemp.options)
        var html = ""
        console.log(noTopicTemp.options)
        var List = "ABCDEFGHIJKLMN"
        for(var i=0;i<options.length;i++){
            html =html+"<p class=\"options\">"+List[i]+"、"+options[i]+"</p>\n"
        }
        $("#topicOptions").html(html)

        $.ajax({
            url: "/clearAnswerCounter",
            type: "post",
            dataType: "json",
            data: {
                topicId: noTopicTemp.topicId
            },
            success: function (res){
                console.log("OOOOOOOOOKKKKKKKKKK")
            }
        })

        setTimeout(function (){
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        },50)

        getAnswerAndShow()
    }
    function getAnswerAndShow(){
        var noTopicTemp = noTopicList[nowShow]
        $.ajax({
            url: "/getAnswerOfNoTopicServlet",
            type: "post",
            dataType: "json",
            data: {
                topicId: noTopicTemp.topicId
            },
            success: function (res){
                showNowAnswer(res)
            }
        })
    }
    function showNowAnswer(answers){
        var html = "\n"
        var chinaNo = "一二三四五六七八九十"
        $("#showCount").html("答案数量："+answers.length)
        for(var i=0;i<answers.length;i++){
            console.log(answers[i].image)
            var analyzes = JSON.parse(answers[i].image)
            var anaHtml = "\n"
            for(var j=0;j<analyzes.length;j++){
                anaHtml = anaHtml+"<img style='max-width: 80%' src='"+ analyzes[j] +"' alt=''>"
            }
            html = html+"<div class=\"section answer\">\n" +
                "<div class='removeAnswer' answerId='"+answers[i].answerId+"' onclick='removeAnswer(this)'>移除</div>"+
                "<div class='confirmAnswer' answerId='"+answers[i].answerId+"' onclick='confirmAnswer(this)'>确认</div>"+
                "<div><span>答案"+chinaNo[i]+"：</span>"+ answers[i].answer +"</div>\n"
            if(analyzes.length>0) html = html+"<hr><div><span>解答过程：</span>"+ anaHtml +"</div>\n"
            html = html+"                            </div>"
        }
        $("#answers").html(html)
        $("#answers").css("display","block")
    }
    function removeAnswer(e){
        $.ajax({
            url: "/removeAnswerServlet",
            type: "post",
            dataType: "json",
            data: {
                answerId: $(e).attr("answerId")
            },
            success: function (res){
                if(res.success){
                    getAnswerAndShow()
                }
            }
        })
    }
    function confirmAnswer(e){
        $.ajax({
            url: "/confirmAnswerServlet",
            type: "post",
            dataType: "json",
            data: {
                answerId: $(e).attr("answerId")
            },
            success: function (res){
                if(res.success){
                    getAnswerAndShow()
                    userInitialization()
                    showAddTopic()
                    noTopicInitialization()
                    setTimeout(function (){
                        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
                    },1000)
                }
            }
        })
    }
    // 删除现在显示的题目
    function deleteNowTopic(){
        $.ajax({
            url: "/removeNoAnswerTopicServlet",
            type: "post",
            dataType: "json",
            data: {topicId: noTopicList[nowShow].topicId},
            success: function (res){
                if(res.success){
                    showAddTopic()
                    noTopicInitialization()
                    setTimeout(function (){
                        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
                    },1000)
                }
            }
        })
    }
    // 获取搜索到的结果并显示


    function showTopic(){
        var showSection = $(showSectionID)
        var html = ""
        for(var i=0;i<noTopic.htmls.length;i++){
            // 题目标题不允许移除
            if(i===0){
                html = html + "" +
                    "                                <div class='topic-text' no='"+ i +"'>\n" +
                    "                                    <strong style='color: #4e8ecf'>"+ contentTitle[i] +"&nbsp;</strong>\n" +
                    "                                    <button style='background-color: orange' onclick='update(this)'>修改</button>\n" +
                    "                                    <div>"+ noTopic.htmls[i] +"</div>\n" +
                    "                                </div>";
            }
            else {
                html = html + "" +
                    "                                <div class='topic-text' no='"+ i +"'>\n" +
                    "                                    <strong style='color: #4e8ecf'>"+ contentTitle[i] +"&nbsp;</strong>\n" +
                    "                                    <button style='background-color: #cc544e' onclick='remove(this)'>移除</button>\n" +
                    "                                    <button style='background-color: orange' onclick='update(this)'>修改</button>\n" +
                    "                                    <button style='background-color: #4e8ccd' onclick='insert(this)'>插入</button>\n" +
                    "                                    <div>"+ noTopic.htmls[i] +"</div>\n" +
                    "                                </div>";
            }
        }
        showSection.html(html)
        showWarning()
    }
    function showWarning(){
        var warnSection = $(showWarningSectionId)
        if(isUpdate==-1){
            warnSection.html("请输入"+ contentTitle[nowStep] +"...")
        }else{
            if(isUpdate==0){
                warnSection.html("请修改标题内容...")
            }else{
                warnSection.html("请修改"+ contentTitle[isUpdate] +"内容或插入新的位置...")
            }
        }
    }

    // 可以读取富文本框的内容为数据库中格式, 需要获取html()
    /*function readDocument(dmt){
        dmt = dmt.replace(/<img( class=\"([^\"]*)\")?( style=\"([^\"]*)\")?( data-cke-saved-src=\"([^\"]*)\")?( src=\"([^\"]*)\")? data-latex=\"([^\"]*)\">/g,"`$9`")
        dmt = dmt.replace(/<.r>/,"")

        dmt = dmt.replace("<sub></sub>","")
        dmt = dmt.replace(/<span[^>]*>/g,"")
        dmt = dmt.replace(/<\/span[^>]*>/g,"")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}_{$4}^{$6}`")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$6}^{$4}`")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sup>([^<]*)<\/sup>)/g,"$1`{$2}^{$4}`")
        dmt = dmt.replace(/([ >`]?)([^` <]+)(<sub>([^<]*)<\/sub>)/g,"$1`{$2}_{$4}`")
        return dmt;
    }*/

    function showAddTopic(){
        $("#answers").css("display","none")
        $("#addTopic").css("display","block");
        $("#nowTopic").css("display","none");
    }
    function showNowTopic(){
        $("#addTopic").css("display","none");
        $("#nowTopic").css("display","block");
    }
</script>
</body>
</html>